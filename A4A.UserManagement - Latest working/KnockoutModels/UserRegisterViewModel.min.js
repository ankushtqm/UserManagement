function User(){function u(n){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(n)}var n=this,r,t;n.UserName=ko.observable();n.CompanyId=ko.observable();n.CompanyName=ko.observable();n.FirstName=ko.observable();n.LastName=ko.observable();n.JobTitle=ko.observable();n.HomePhone=ko.observable("");n.OfficePhone=ko.observable("");n.OfficePhoneExtension=ko.observable("");n.MobilePhone=ko.observable("");n.PrimaryFax=ko.observable("");r={email:/^([\d\w-\.]+@([\d\w-]+\.)+[\w]{2,4})?$/};n.test=ko.observable();n.step1Validation=ko.validatedObservable([n.UserName.extend({required:{message:" E-mail is required."},pattern:{message:"Must be a valid email",params:r.email}}),n.CompanyName.extend({required:{message:" CompanyName is required."}}),n.FirstName.extend({required:{message:" FirstName is required."}}),n.LastName.extend({required:{message:" LastName is required."}}),n.HomePhone.extend({validation:{validator:function(n){return n===null||n===""||typeof n=="undefined"||/^(0|[0-9][0-9]*)$/.test(n)},message:" Home Phone Number contains digits only!"}}),n.OfficePhone.extend({validation:{validator:function(n){return n===null||n===""||typeof n=="undefined"||/^(0|[0-9][0-9]*)$/.test(n)},message:" Office Phone Number contains digits only!"}}),n.OfficePhoneExtension.extend({validation:{validator:function(n){return n===null||n===""||typeof n=="undefined"||/^(0|[0-9][0-9]*)$/.test(n)},message:" Phone Extension contains digits only!"}}),n.MobilePhone.extend({validation:{validator:function(n){return n===null||n===""||typeof n=="undefined"||/^(0|[0-9][0-9]*)$/.test(n)},message:" Mobile Phone Number contains digits only!"}}),n.PrimaryFax.extend({validation:{validator:function(n){return n===null||n===""||typeof n=="undefined"||/^(0|[1-9][0-9]*)$/.test(n)},message:" Fax Number contains digits only!"}}),]);n.removebtn=ko.observable(!1);n.WebPage=ko.observable();n.Twitter=ko.observable();n.Facebook=ko.observable();n.LinkedIn=ko.observable();n.GooglePlus=ko.observable();n.Pinterest=ko.observable();n.ErrorMessage=ko.observable();n.InfoMessage=ko.observable();n.ErrorMessageGM=ko.observable();n.InfoMessageGM=ko.observable();n.MessageSM=ko.observable();n.InfoMessageMembers=ko.observable();n.InfoMessageEmail=ko.observable();n.ProviderUserKey=ko.observable();n.UserId=ko.observable();n.PreferredName=ko.observable();n.Email=ko.observable().extend({email:!0});n.Password=ko.observable();n.EmailContent=ko.observable();n.GroupId=ko.observable();n.GroupName=ko.observable();n.RolePlaceHolder=ko.observable("Select Role");n.IsActiveContact=ko.observable(!0);n.isEconUser=ko.observable(!1);n.isACHUser=ko.observable(!1);n.isMemberCompany=ko.observable(!1);n.showCompanyLabel=ko.observable(!1);n.rdoFuel=ko.observable("No");n.IsActiveFF=ko.computed(function(){return n.rdoFuel()==="Yes"?!0:!1});n.rdoMembers=ko.observable("No");n.IsActiveMB=ko.computed(function(){return n.rdoMembers()==="Yes"?!0:!1});n.rdoACH=ko.observable("No");n.IsActiveACH=ko.computed(function(){return n.rdoACH()==="Yes"?!0:!1});n.isNew=ko.observable(!0);n.ShowErr=ko.observable(!1);n.rdoMembers.subscribe(function(){n.IsActiveContact()&&!n.isMemberCompany()&&(n.securityGroupCount(),n.SecurityGrpCnt>0&&n.rdoMembers()=="No"&&(alert("Can't remove Member Portal access when user is still part of security group! "),n.rdoMembers("Yes")))});n.IsActiveContact.subscribe(function(){n.IsActiveContact()?n.SetMBEnabled():(n.rdoFuel("No"),n.rdoMembers("No"),n.rdoACH("No"))});n.UserName.subscribe(function(){n.removeErrors();n.Email(n.UserName());u(n.UserName())&&n.UserExists()});n.FirstName.subscribe(function(){n.removeErrors();n.PreferredName(n.FirstName()+" "+n.LastName())});n.LastName.subscribe(function(){n.removeErrors();n.PreferredName(n.FirstName()+" "+n.LastName())});n.removeErrors=function(){n.ShowErr(!1)};n.errors=function(){ko.validation.group(this)};n.ShowErr=ko.observable(!1);n.SecurityGrpCnt=0;n.UserGroups=ko.observableArray([]);n.getEconUser=function(){$.ajax({url:"/api/GetIsCurrentUserITorECON/",contentType:"application/json",success:function(t){n.isEconUser(t)}})};n.getACHUser=function(){$.ajax({url:"/api/GetIsCurrentUserITorACH/",contentType:"application/json",success:function(t){n.isACHUser(t)}})};this.selectedCompany=function(t,i){n.CompanyId(i.item.text);n.CompanyName(i.item.label);n.SetMBEnabled()};t=!1;n.SetMBEnabled=function(){n.CompanyName().toLowerCase().indexOf("non member")<1&&n.CompanyName().toLowerCase().indexOf("member")>0?(n.isMemberCompany(!0),n.rdoMembers("Yes")):n.isMemberCompany(!1)};n.UserExists=function(i){$(".overlay").show();var r="";r=n.UserName()&&n.UserName().length>0&&isNaN(i)?"/api/GetIsUserExisting?email="+n.UserName():"/api/GetIsUserExisting?userId="+i;t||($.getJSON(r,function(t){if(t.length>2){var r=JSON.parse(t),u=r[0].UserId;$("#hdnUserId").val(u);n.isNew(!1);n.UserName()&&n.UserName().length>0&&isNaN(i)?($("#hdnUserName").val(n.UserName()),n.InfoMessage("This contact is already in the system. We have pre-populated this form with any information we have on this user. Please review carefully before finalizing your changes. ")):isNaN(i)||(n.UserName(r[0].Email),$("#hdnUserName").val(n.UserName()));n.CompanyName(r[0].CompanyName);n.CompanyId(r[0].CompanyId);$("#txtCompanyName").hide();$("#hypCreateNewCompany").hide();n.showCompanyLabel(!0);n.FirstName(r[0].FirstName);n.LastName(r[0].LastName);n.JobTitle(r[0].JobTitle);n.HomePhone(r[0].HomePhone);n.OfficePhone(r[0].OfficePhone);n.OfficePhoneExtension(r[0].OfficePhoneExtension);n.MobilePhone(r[0].MobilePhone);n.PrimaryFax(r[0].PrimaryFax);n.WebPage(r[0].WebPage);n.Twitter(r[0].Twitter);n.Facebook(r[0].Facebook);n.LinkedIn(r[0].LinkedIn);n.GooglePlus(r[0].GooglePlus);n.Pinterest(r[0].Pinterest);n.IsActiveContact(r[0].IsActiveContact);r[0].IsActiveFF?n.rdoFuel("Yes"):n.rdoFuel("No");r[0].IsActiveMB?n.rdoMembers("Yes"):n.rdoMembers("No");r[0].IsActiveACH?n.rdoACH("Yes"):n.rdoACH("No");n.Password(r[0].Password);n.FirstName(r[0].FirstName);n.LastName(r[0].LastName);userRegisterViewModel.addUserAddViewModel.Load();n.loadUserGroups();n.SetMBEnabled();n.getEmailContent()}else!(n.FirstName()===undefined)&&n.FirstName().length>1&&($("#txtCompanyName").hide(),$("#hypCreateNewCompany").hide(),n.showCompanyLabel(!0),n.FirstName(""),n.LastName(""),n.JobTitle(""),n.HomePhone(""),n.OfficePhone(""),n.OfficePhoneExtension(""),n.MobilePhone(""),n.PrimaryFax(""),n.WebPage(""),n.Twitter(""),n.Facebook(""),n.LinkedIn(""),n.GooglePlus(""),n.Pinterest(""),n.rdoFuel("No"),n.rdoMembers("No"),n.rdoACH("No"),n.Password(""),n.FirstName(""),n.LastName(""),n.InfoMessage(""))}),isNaN(i)||(t=!0));$(".overlay").hide()};this.getCompany=function(n,t){$.ajax({url:"/api/GetAllCompanies/",type:"GET",cache:!1,data:n,dataType:"json",success:function(n){t($.map(n,function(n,t){return{label:t,text:n,value:""}}))}})};n.InActivateUser=function(){n.IsActiveContact(!1);n.resetMessages();n.SaveUsertoDB(1);n.InfoMessage("This user has been removed from database. He won't show up in the Global Address Book or the User search on the home page.")};n.SaveUser=function(){n.resetMessages();var t=ko.validation.group(userRegisterViewModel.addUserViewModel,{deep:!0});if(n.step1Validation.isValid()){if(!isNaN(n.CompanyId())){if(n.ShowErr(!1),n.UserGroups().length>0&&!n.IsActiveContact()){alert("User still has Groups assigned and IsActive Contact set to FALSE. Remove all groups to InActivate user!");return}n.securityGroupCount($("#hdnUserId").val());n.UserGroups().length>0&&n.SecurityGrpCnt===0&&!(n.CompanyName().toLowerCase().indexOf("non member")>0);isNaN($("#hdnUserId").val())||n.UserGroups().length>0?n.SaveUsertoDB(0):n.isNew()?n.SaveUsertoDB(0):n.IsActiveContact()?confirm("This users is not part of any groups now. If you select 'OK', it will be saved as inactive. If you select 'Cancel' the contact will continue to stay active.")===!0?n.InActivateUser():n.SaveUsertoDB(0):n.SaveUsertoDB(0)}n.InfoMessage("")}else return n.test("invalid"),n.step1Validation.errors.showAllMessages(),!1};n.SaveUsertoDB=function(t){$(".overlay").show();var i=ko.toJSON(this);$.ajax({url:"/api/User?CompanyId="+n.CompanyId()+"&password="+n.Password(),type:"post",data:i,contentType:"application/json",success:function(){t===0?n.InfoMessage("Contact details saved successfully!!"):n.InfoMessage("Contact inactivated successfully!!");$("#txtCompanyName").hide();$("#hypCreateNewCompany").hide();n.showCompanyLabel(!0)},error:function(t){$(".overlay").hide();n.InfoMessage("");n.ErrorMessage("Contact not saved! An error occured -"+t.responseText)}}).done(function(i){n.ErrorMessage("");$("#hdnUserId").val(i.UserId);$("#hdnUserName").val(n.UserName());n.isNew(!1);n.Password(i.Password);$("#Headtitle").html("New User Wizard");$(".UserTitle").html().indexOf("User:")>0||$(".UserTitle").append("<br/> <span class='niceLabel-black margin-topbot10'>User: "+$("#hdnUserName").val()+"<\/span");t===0&&n.getEmailContent();$(".overlay").hide()})};n.load=function(t){var i=JSON.parse(t.responseText);n.isNew(!1)};n.loadUserGroups=function(){if(isNaN($("#hdnUserId").val()))n.ErrorMessage("Could not find the UserId ");else{n.UserGroups.removeAll();var t="/api/GetGroupUserlineItem/?UserId="+$("#hdnUserId").val();$.ajax({url:t,type:"GET",datatype:"json",processData:!1,contentType:"application/json; charset=utf-8",success:function(t){var u=JSON.parse(t),r;for(i=0;i<u.length;i++)r={},r.GroupName=u[i].GroupName,r.GroupType=u[i].GroupType,r.GroupId=u[i].GroupId,r.Role=u[i].Role,r[u[i].Role.replace(/\s/g,"")]=!0,r.CompanyName=u[i].CompanyName,r.UserId=$("#hdnUserId").val(),r.IsCurrentUserAdmin=u[i].IsCurrentUserAdmin>0?!0:!1,n.UserGroups.push(r)},error:function(t){n.ErrorMessage(" "+t.responseText)}})}};n.role=ko.observable();n.Roles=ko.observableArray();n.Roles.push({name:"",value:"Select a Role"});n.getRoles=function(){$.ajax({url:"/api/GetRolesbyGroupID/?GroupId="+n.GroupId(),type:"GET",datatype:"json",processData:!1,contentType:"application/json; charset=utf-8",success:function(t){n.Roles.removeAll();for(key in t){var i={name:key,value:t[key]};n.Roles.push(i)}},error:function(t){n.ErrorMessageGM("Error loading roles for group:"+t.responseText);n.InfoMessageGM("")}})};n.clearUserGroups=function(){$("#usersGrps").val("")};n.GetAllGroups=function(t,i){var r=t.term;$.ajax({url:"/api/GetAllGroups/?CompanyId="+n.CompanyId()+"&isActiveMB="+n.IsActiveMB(),type:"GET",cache:!1,data:t,dataType:"json",success:function(n){i($.map(n,function(n,t){return{label:n,text:t,value:""}}))},error:function(){n.InfoMessageGM("")}})};n.UpdateUserIdtoUserGroups=function(){for(i=0;i<n.UserGroups().length;i++)n.UserGroups()[i].UserId=$("#hdnUserId").val()};n.AddGroup=function(){var r;if(n.IsActiveContact()){n.resetMessages();var i=$("#inpGroupRole option[value='"+n.role()+"']").text().replace(/\s/g,""),s=$("#hdnUserId").val(),f=ko.utils.arrayFirst(n.UserGroups(),function(t){if(n.GroupName().indexOf(t.GroupName)>0)return i==t.Role});if(f)n.ErrorMessageGM("Group <span class='text-info'>"+n.GroupName()+"<\/span> along with the role <span class='text-info'>"+i+"<\/span>  has already been added to the UserGroups. Choose a different group or role!"),setTimeout(function(){n.ErrorMessage("")},4e3);else if(i.length>1&&!isNaN(n.GroupId())){var t={},u=n.GroupName().indexOf("("),e=n.GroupName().substring(u+1).replace(")",""),o=n.GroupName().replace(n.GroupName().substring(u),"");t.GroupName=o;t.GroupType=e;t.GroupId=n.GroupId();t.Role=i;t[i.replace(/\s/g,"")]=!0;t.CompanyName="";t.UserId=$("#hdnUserId").val();t.IsCurrentUserAdmin=!0;r=ko.utils.stringifyJson(t);r="["+r+"]";$.ajax({url:"/api/UserGroup",type:"post",data:r,contentType:"application/json",success:function(){n.UserGroups.push(t);n.InfoMessageGM(n.GroupName()+i+" - Contact added to the group successfully!");setTimeout(function(){n.InfoMessage("")},4e3)},error:function(t){n.ErrorMessageGM("Error in adding contact to group:"+t.responseText);setTimeout(function(){n.ErrorMessageGM("")},4e3)}});n.IsActiveContact()||n.IsActiveContact(!0)}else n.ErrorMessageGM("GroupId or RoleName not captured correctly!"),setTimeout(function(){n.ErrorMessageGM("")},4e3)}else n.ErrorMessageGM("Contact is inactive. Activate contact by checking the box in group details screen and then hitting the 'Save Details' button so you can add user to the groups!"),setTimeout(function(){n.ErrorMessage("")},4e3)};n.SaveGroup=function(){$(".overlay").show();var t=ko.utils.stringifyJson(n.UserGroups());$.ajax({url:"/api/UserGroup/",type:"post",data:t,contentType:"application/json",success:function(){n.InfoMessageGM("Contact's Group Membership has been saved successfully");setTimeout(function(){n.InfoMessageGM("")},4e3);n.InfoMessage("All Contact Details, Membership and User Groups have been saved successfully!!");setTimeout(function(){n.InfoMessage("")},4e3)},error:function(t){return t.responseText.indexOf("Contact is already a member of this Group. Remove group and save again.")===0&&(n.ErrorMessageGM("Error:"+t.responseText),setTimeout(function(){n.ErrorMessageGM("")},4e3)),!1}}).done(function(){$(".overlay").hide()})};n.SelectGroupforUser=function(t,i){n.GroupId(i.item.text);n.GroupName(i.item.label);n.getRoles()};n.securityGroupCount=function(t){t!==undefined&&t!=null&&t>0||(t=$("#hdnUserId").val());var i=$.ajax({url:"/api/isSecurityGroupCount/?uid="+t,async:!1,success:function(t){n.SecurityGrpCnt=t},error:function(n,t,i){return i}})};n.removeUserGroup=function(t){var i=ko.utils.stringifyJson(t);i="["+i+"]";$.ajax({url:"/api/RemoveGroupUser",type:"post",data:i,contentType:"application/json",success:function(){n.InfoMessageGM("Successfully removed the user group!");setTimeout(function(){n.InfoMessageGM("")},4e3)},error:function(t){return n.ErrorMessageGM("Error in removing group user."+t.responseText),setTimeout(function(){n.ErrorMessageGM("")},4e3),!1}});n.UserGroups.remove(t);n.UserGroups().length<1&&(confirm("This users is not part of any groups now. If you select 'OK', it will be saved as inactive. If you select 'Cancel' the contact will continue to stay active.")===!0?n.InActivateUser():n.SaveUsertoDB(0))};n.resetMessages=function(){n.InfoMessage("");n.InfoMessageGM("");n.ErrorMessage("");n.ErrorMessageGM("")};n.setEmailType=function(){n.emailType=0;n.IsActiveContact()&&n.IsActiveMB()&&!n.IsActiveFF()&&!n.IsActiveACH()&&(n.emailType=1);n.IsActiveContact()&&!n.IsActiveMB()&&n.IsActiveFF()&&!n.IsActiveACH()&&(n.emailType=2);n.IsActiveContact()&&!n.IsActiveMB()&&!n.IsActiveFF()&&n.IsActiveACH()&&(n.emailType=4);n.IsActiveContact()&&n.IsActiveMB()&&n.IsActiveFF()&&!n.IsActiveACH()&&(n.emailType=3);n.IsActiveContact()&&n.IsActiveMB()&&!n.IsActiveFF()&&n.IsActiveACH()&&(n.emailType=5);n.IsActiveContact()&&!n.IsActiveMB()&&n.IsActiveFF()&&n.IsActiveACH()&&(n.emailType=6);n.IsActiveContact()&&n.IsActiveMB()&&n.IsActiveFF()&&n.IsActiveACH()&&(n.emailType=7)};n.getEmailContent=function(){n.setEmailType();switch(n.emailType){case 1:n.EmailContent(' <p>Welcome to the A4A Member Portal. Below you will find your username and temporary password for access to the site.  Please click the "Login" link below. <\/p>  <br/>  <p> Once you log in with your temporary password, you will be prompted to change it. <\/p>  <br/>  <p>   Username: '+n.Email()+" <\/p>  <p>   Password: ********* <\/p> <a href=\"/\" title='Member Portal Login'>Login<\/a>");$("#z-tab3").show();n.MessageSM("");break;case 2:n.EmailContent(' <p>Welcome to the A4A Fuel Portal. Below you will find your username and temporary password for access to the site.  Please click the"Login" link below. <\/p>  <br/>   <p> Once you log in with your temporary password, you will be prompted to change it. <\/p>  <br/>   <p>   Username: '+n.Email()+" <\/p>  <p>   Password: ********* <\/p> <a href=\"/\" title='Fuel Portal Login'>Login<\/a>");$("#z-tab3").show();n.MessageSM("");break;case 3:n.EmailContent(" <p>Welcome to the A4A Member Portal and Fuel Portal. Below you will find your username and temporary password for access to the site. Please click the “Member Portal Login” or “Fuel Portal Login” link below.<\/p>  <br/>   <p> Once you log in with your temporary password, you will be prompted to change it. <\/p>  <br/>   <p>   Username: "+n.Email()+" <\/p>  <p>   Password: ********* <\/p> <a href=\"/\" title='Fuel Portal Login'>Fuel Portal Login<\/a> | <a href=\"/\" title='Member Portal Login'>Member Portal Login<\/a>");$("#z-tab3").show();n.MessageSM("");break;case 4:n.EmailContent(' <p>Welcome to the A4A ACH Portal. Below you will find your username and temporary password for access to the site.  Please click the "Login" link below. <\/p>  <br/>   <p> Once you log in with your temporary password, you will be prompted to change it. <\/p>  <br/>   <p>   Username: '+n.Email()+" <\/p>  <p>   Password: ********* <\/p> <a href=\"/\" title='ACH Portal Login'>Login<\/a>");$("#z-tab3").show();n.MessageSM("");break;case 5:n.EmailContent(' <p>Welcome to the A4A Member Portal and ACH Portal. Below you will find your username and temporary password for access to the site.  Please click the "Login" link below. <\/p>  <br/>  <p> Once you log in with your temporary password, you will be prompted to change it. <\/p>  <br/>  <p>   Username: '+n.Email()+" <\/p>  <p>   Password: ********* <\/p> <a href=\"/\" title='Member Portal Login'> Member Portal Login<\/a> | <a href=\"/\" title='ACH Portal Login'> ACH Portal Login<\/a>");$("#z-tab3").show();n.MessageSM("");break;case 6:n.EmailContent(' <p>Welcome to the A4A Fuel Portal and ACH Portal. Below you will find your username and temporary password for access to the site.  Please click the "Login" link below. <\/p>  <br/>  <p> Once you log in with your temporary password, you will be prompted to change it. <\/p>  <br/>  <p>   Username: '+n.Email()+" <\/p>  <p>   Password: ********* <\/p> <a href=\"/\" title='Fuel Portal Login'> Fuel Portal Login<\/a> | <a href=\"/\" title='ACH Portal Login'> ACH Portal Login<\/a>");$("#z-tab3").show();n.MessageSM("");break;case 7:n.EmailContent(' <p>Welcome to the A4A Member Portal, A4A Fuel Portal, and ACH Portal. Below you will find your username and temporary password for access to the site.  Please click the "Login" link below. <\/p>  <br/>  <p> Once you log in with your temporary password, you will be prompted to change it. <\/p>  <br/>  <p>   Username: '+n.Email()+" <\/p>  <p>   Password: ********* <\/p> <a href=\"/\" title='Member Portal Login'> Member Portal Login<\/a> | <a href=\"/\" title='Fuel Portal Login'> Fuel Portal Login<\/a> | <a href=\"/\" title='ACH Portal Login'> ACH Portal Login<\/a>");$("#z-tab3").show();n.MessageSM("");break;default:n.EmailContent("");n.MessageSM("User is not active member of any sites. So an email wont be sent out.");$("#z-tab3").hide()}};n.SendEmail=function(){var i,t;n.InfoMessageEmail("Sending E-Mail to the user....");i={};body=$("#divEmailContent").html().replace("*********",n.Password());to="naamidala@airlines.org";from="userManagement@airlines.org";subject="Your A4A User Management Account";bodyIsHtml=!0;t="/api/SendEmail/?body="+body+"&to="+to+"&from="+from+"&subject="+subject+"&bodyIsHtml="+bodyIsHtml;$.ajax({url:t,type:"post",contentType:"application/json",success:function(){n.MessageSM("");n.InfoMessageEmail("Confirmation Email has been sent successfully!!")},error:function(t){return n.MessageSM("Error in sending confirmation email."+t.responseText),!1}})}}var userRegisterViewModel,Address,userAddress;setChosen=function(){ko.bindingHandlers.chosen={init:function(n){$(n).addClass("chzn-select");$(n).chosen()},update:function(n){$(n).trigger("liszt:updated")}}};Address=function(n,t,i,r,u,f,e,o,s){this.AddressId=ko.observable(n);this.AddressType=ko.observable(t);this.Address1=ko.observable(i);this.Address2=ko.observable(r);this.City=ko.observable(u);this.State=ko.observable(f);this.ZipCode=ko.observable(e);this.Province=ko.observable(o);this.Country=ko.observable(s)};userAddress=function(){var n=this,t;n.uId=ko.observable($("#hdnUserId").val());t=$("#hdnUserId").val();n.ShowErr=ko.observable(!1);n.Addresses=ko.observableArray();n.ErrorMessage=ko.observable();n.InfoMessage=ko.observable();n.AddressType=ko.observable();n.Address1=ko.observable("");n.Address2=ko.observable("");n.City=ko.observable("");n.State=ko.observable("");n.ZipCode=ko.observable("");n.Province=ko.observable("");n.Country=ko.observable("");n.step2Validation=ko.validatedObservable([n.Address1.extend({required:{message:" Address1 is required."}}),]);n.addUserAddress=function(){var i=ko.validation.group(userRegisterViewModel.addUserAddViewModel,{deep:!0}),t;if($(".overlay").show(),n.step2Validation.isValid())$("#hdnUserName").val().trim().length>0&&(t=ko.toJSON(this),$.ajax({url:"/api/SaveAddress/?addressType=1&email="+$("#hdnUserName").val(),type:"post",data:t,contentType:"application/json",success:function(){$(".overlay").hide();n.InfoMessage("User Address saved successfully!");setTimeout(function(){n.InfoMessage("")},4e3);n.Addresses.push(new Address(0,1,n.Address1(),n.Address2(),n.City(),n.State(),n.ZipCode(),n.Province(),n.Country()));n.Address1("");n.Address2("");n.City("");n.State("");n.ZipCode("");n.Province("");n.Country("");n.step2Validation.errors.showAllMessages(!1)},error:function(t){$(".overlay").hide();n.ErrorMessage("Error occured while saving User Address!"+t.responseText);setTimeout(function(){n.InfoMessage("")},4e3)}}).done());else return n.step2Validation.errors.showAllMessages(),$(".overlay").hide(),!1;$(".overlay").hide()};n.Load=function(){var t="/api/getuseraddress/?UserId="+$("#hdnUserId").val();$.ajax({url:t,type:"GET",datatype:"json",processData:!1,contentType:"application/json; charset=utf-8",success:function(t){var r=JSON.parse(t);for(i=0;i<r.length;i++)n.Addresses.push(new Address(r[i].AddressId,r[i].AddressTypeId,r[i].Address1,r[i].Address2,r[i].City,r[i].State,r[i].ZipCode,r[i].Province,r[i].Country))},error:function(t){n.ErrorMessage("Exception in loading addresses:"+t.responseText)}})};n.removeAddress=function(t){$.ajax({url:"/api/RemoveAddress?AddressId="+t.AddressId()+"&UserId="+$("#hdnUserId").val(),type:"post",data:t,contentType:"application/json",success:function(){n.InfoError("Address deleted successfully!")},error:function(t){return n.ErrorMessage("Error:"+t.responseText),!1}});n.Addresses.remove(t)}};ko.bindingHandlers.ko_autocomplete={init:function(n,t){$(n).autocomplete(t())},update:function(n,t){$(n).autocomplete("option","source",t().source)}};ko.observableArray.fn.distinct=function(n){var t=this;return t.index={},t.index[n]=ko.observable({}),ko.computed(function(){var i={};ko.utils.arrayForEach(t(),function(t){var r=ko.utils.unwrapObservable(t[n]);r&&(i[r]=i[r]||[],i[r].push(t))});t.index[n];t.index[n](i)}),t};$(document).ready(function(){function n(n){for(var u=decodeURIComponent(window.location.search.substring(1)),r=u.split("&"),t,i=0;i<r.length;i++)if(t=r[i].split("="),t[0]===n)return t[1]===undefined?!0:t[1]}sessionStorage.clear();$(".editable").each(function(){this.contentEditable=!0});ko.validation.init({insertMessages:!1});parseInt(n("uid"))>0?(userRegisterViewModel={addUserViewModel:new User,addUserAddViewModel:new userAddress},ko.applyBindings(userRegisterViewModel),$.when(userRegisterViewModel.addUserViewModel.getCompany(),userRegisterViewModel.addUserViewModel.getEconUser(),userRegisterViewModel.addUserViewModel.getACHUser()).done()):(userRegisterViewModel={addUserViewModel:new User,addUserAddViewModel:new userAddress},ko.applyBindings(userRegisterViewModel),$.when(userRegisterViewModel.addUserViewModel.getCompany(),userRegisterViewModel.addUserViewModel.getEconUser(),userRegisterViewModel.addUserViewModel.getACHUser()).done())});